[buildout]

parts +=
	loris-source
	eggs-install
	omelette
	cron-script1
	cache-cron
	log-cache-dirs
	loris-conf
	start-script
	script-perms
	apache
	mod-wsgi-install
	apache-wsgi-config
	loris-wsgi
	wsgi-perms
	apache-httpd-config
	compile-kakadu
	copy-apps-libs

[compile-kakadu]
recipe = collective.recipe.cmd
on_install = true
cmds = cd ${buildout:directory}/../../Downloads/kakadu/make; echo 'DEFINES += -DKDU_NO_SSSE3\nINCLUDES += -I/usr/lib/jvm/java-7-openjdk-amd64/include\n
INCLUDES += -I/usr/lib/jvm/java-7-openjdk-amd64/include/linux\n' >> /home/bodl-loris-srv/Downloads/kakadu/apps/make/Makefile-Linux-x86-64-gcc; make -f Makefile-Linux-x86-64-gcc;

[copy-apps-libs]
recipe = collective.recipe.cmd
on_install = true
cmds = rm ${buildout:directory}/src/loris/lib/Linux/x86_64/libkdu_v72R.so; cp ${buildout:directory}/../../Downloads/kakadu/apps/make/*.so ${buildout:directory}/parts/loris/lib/Linux/x86_64/; cp ${buildout:directory}/../../Downloads/kakadu/bin/Linux-x86-64-gcc/kdu_expand ${buildout:directory}/parts/loris/bin/Linux/x86_64/